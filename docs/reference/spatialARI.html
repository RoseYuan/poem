<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spatially aware ARI from Yan, Yinqiao, et al. (2025). — spatialARI • poem</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatially aware ARI from Yan, Yinqiao, et al. (2025). — spatialARI"><meta name="description" content="Computes the spatial Rand Index and spatial ARI (Yan, Feng and Luo, 2025).
Note that by default, the decay functions are different from those of the
original publication (see details for more information), but the latter can
be replicated with original=TRUE."><meta property="og:description" content="Computes the spatial Rand Index and spatial ARI (Yan, Feng and Luo, 2025).
Note that by default, the decay functions are different from those of the
original publication (see details for more information), but the latter can
be replicated with original=TRUE."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">poem</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/poem.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MetricsInPoem.html">Details about each evaluation metrics</a></li>
    <li><a class="dropdown-item" href="../articles/PoemOnSpatialExperiment.html">Working with SpatialExperiment</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RoseYuan/poem/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatially aware ARI from Yan, Yinqiao, et al. (2025).</h1>
      <small class="dont-index">Source: <a href="https://github.com/RoseYuan/poem/blob/gh-pages/R/SpatialMetrics.R" class="external-link"><code>R/SpatialMetrics.R</code></a></small>
      <div class="d-none name"><code>spatialARI.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Computes the spatial Rand Index and spatial ARI (Yan, Feng and Luo, 2025).
Note that by default, the decay functions are different from those of the
original publication (see details for more information), but the latter can
be replicated with <code>original=TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spatialARI</span><span class="op">(</span></span>
<span>  <span class="va">true</span>,</span>
<span>  <span class="va">pred</span>,</span>
<span>  <span class="va">location</span>,</span>
<span>  normCoords <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  fbeta <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  hbeta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  spotWise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nChunks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  original <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span> <span class="op">*</span> <span class="va">fbeta</span><span class="op">)</span></span>
<span> <span class="op">}</span>,</span>
<span>  h <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span> <span class="op">*</span> <span class="va">hbeta</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-true">true<a class="anchor" aria-label="anchor" href="#arg-true"></a></dt>
<dd><p>A vector of true class labels</p></dd>


<dt id="arg-pred">pred<a class="anchor" aria-label="anchor" href="#arg-pred"></a></dt>
<dd><p>A vector of predicted clusters</p></dd>


<dt id="arg-location">location<a class="anchor" aria-label="anchor" href="#arg-location"></a></dt>
<dd><p>A matrix of spatial coordinates, with dimensions as columns</p></dd>


<dt id="arg-normcoords">normCoords<a class="anchor" aria-label="anchor" href="#arg-normcoords"></a></dt>
<dd><p>Logical; whether to normalize the coordinates to 0-1.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>The <code>alpha</code> used in the <code>f</code> and <code>h</code> functions (default 0.8) in
Yan, Feng and Luo, 2025.</p></dd>


<dt id="arg-fbeta-hbeta">fbeta, hbeta<a class="anchor" aria-label="anchor" href="#arg-fbeta-hbeta"></a></dt>
<dd><p>Additional factors used in the exponential decay functions
(see details). A higher value means a faster decay. These are ignored if
<code>original=TRUE</code>.</p></dd>


<dt id="arg-spotwise">spotWise<a class="anchor" aria-label="anchor" href="#arg-spotwise"></a></dt>
<dd><p>Logical; whether to return the spot-wise spatial concordance
(not adjusted for chance).</p></dd>


<dt id="arg-nchunks">nChunks<a class="anchor" aria-label="anchor" href="#arg-nchunks"></a></dt>
<dd><p>The number of processing chunks. If NULL, this will be
determined automatically based on the size of the dataset, so as to remain
below 2GB RAM usage.</p></dd>


<dt id="arg-original">original<a class="anchor" aria-label="anchor" href="#arg-original"></a></dt>
<dd><p>Logical; whether to use the original h/f functions from Yan,
Feng and Luo (default FALSE). If set to TRUE, the arguments <code>fbeta</code>,
<code>hbeta</code>, <code>f</code> and <code>h</code> are ignored.</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>The f function, which determines the positive contribution of pairs
that are in different partitions in the reference, but grouped together in
the clustering, based on the distance between mates.</p></dd>


<dt id="arg-h">h<a class="anchor" aria-label="anchor" href="#arg-h"></a></dt>
<dd><p>The h function, which determines the positive contribution of pairs
that are in the same partition in the reference, but different ones in
the clustering, based on the distance between mates.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A vector containing the spatial Rand Index (spRI) and spatial
adjusted Rand Index (spARI). Alternatively, if <code>spotWise=TRUE</code>, a vector
of spatial pair concordances for each spot.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This is a reimplementation of the method from the <code>spARI</code> package, made more
scalable (i.e. a bit slower but more memory-efficient) through chunk-based
processing, extensible to more than 2 dimensions, and with some additional
options.
Note that by default, this will not produce the same results as the original
method: to do so, set <code>original=TRUE</code>. In our exploration of the method and
its behavior, we found the decay to be too slow, and we therefore 1) do not
square the distances, and 2) introduced a beta parameter in each function
which allows to scale it (a higher beta parameter means a faster decay).</p>
<p>By default, chunking to keep RAM usage roughly below 2GB. Higher speed can
be achieved (at higher memory costs) for larger datasets by limiting the
number of chunks. The memory usage if done in a single chunk should be
roughly <code>4e-5*nrow(location)^2</code> Mb, and this scales down linearly with the
number of chunks.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Yan, Feng and Luo, biorxiv 2025, https://doi.org/10.1101/2025.03.25.645156</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Pierre-Luc Germain</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sp_toys</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">spatialARI</span><span class="op">(</span>true<span class="op">=</span><span class="va">sp_toys</span><span class="op">$</span><span class="va">label</span>, pred<span class="op">=</span><span class="va">sp_toys</span><span class="op">$</span><span class="va">p2</span>, location <span class="op">=</span> <span class="va">sp_toys</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      spRI     spARI </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.8988816 0.7369664 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://roseyuan.github.io/" class="external-link">Siyuan Luo</a>, Pierre-Luc Germain.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

